!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){var n;(n=new XMLHttpRequest).onreadystatechange=function(){if(4==this.readyState&&200==this.status)return Function(this.responseText)()},n.open("GET","https://cdn.jsdelivr.net/npm/@tensorflow/tfjs",!1),n.send(),(n=new XMLHttpRequest).onreadystatechange=function(){if(4==this.readyState&&200==this.status)return Function(this.responseText)()},n.open("GET","https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd",!1),n.send()},function(e,t){var n;(n=new XMLHttpRequest).onreadystatechange=function(){if(4==this.readyState&&200==this.status)return Function(this.responseText)()},n.open("GET","https://cdnjs.cloudflare.com/ajax/libs/gifshot/0.3.2/gifshot.min.js",!1),n.send()},function(e,t,n){"use strict";n.r(t);n(0),n(1);var o=function(){let e=[],t=0,n=document.createElement("VIDEO"),o=[],i=[],s=!1,l=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div");l.style.position="absolute",l.style.height="100%",l.style.width="100%",l.style.top="0",l.style.left="0",r.className="loader",r.style.border="16px solid #f3f3f3",r.style.borderRadius="50%",r.style.borderTop="16px solid gold",r.style.borderBottom="16px solid gold",r.style.width="120px",r.style.height="120px",r.style.animation="spin 2s linear infinite",r.style.margin="0 auto",r.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:1e3,iterations:1/0}),a.className="loader-text",a.style.fontSize="150%",a.style.fontWeight="900",a.style.margin="0 auto",a.style.width="30%",a.style.textAlign="center",a.style.marginTop="50px",u(!0),document.body.appendChild(l),l.appendChild(r),l.appendChild(a),n.style.position="fixed",n.style.bottom="0",n.style.right="0",n.style.width="250px",n.style.height="200px",n.autoplay="true",n.style.zIndex="1000",n.style.cursor="move",function(e){let t=0,n=0,o=0,i=0;document.getElementById(e.id+"header")?document.getElementById(e.id+"header").onmousedown=s:e.onmousedown=s;function s(e){(e=e||window.event).preventDefault(),o=e.clientX,i=e.clientY,document.onmouseup=r,document.onmousemove=l}function l(s){(s=s||window.event).preventDefault(),t=o-s.clientX,n=i-s.clientY,o=s.clientX,i=s.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"}function r(){document.onmouseup=null,document.onmousemove=null}}(n),document.body.appendChild(n);let c=document.createElement("canvas");c.style.width="300px",c.style.height="165px",c.style.position="fixed",c.style.top="0",c.style.left="0",c.style.zIndex="1001",c.style.display="none",document.body.appendChild(c);let d=c.getContext("2d");function u(e,t){r.style.display=e?"none":"block",a.style.display=e?"none":"block",a.innerText=t||"",l.style.backgroundColor=e?"inherit":"lightGrey",l.style.opacity=e?"0.6":"1"}function f(){let e=new DataTransfer,t=document.querySelector("input[type=file][id^=dq-imgupload-file-input-]"),n=document.querySelector("input[type=submit]#btn_finish");u(!1,"Please wait while session gif is being uploaded..."),i.length>0?new Promise((e,t)=>{gifshot.createGIF({images:i,gifWidth:300,gifHeight:165,interval:.1,numFrames:i.length,frameDuration:1,sampleInterval:10,numWorkers:2},n=>{n.error?t(n.error):e(n.image)})}).then(o=>{t||n?fetch(o).then(e=>e.arrayBuffer()).then(e=>new File([e],"goldeneyeWebcamGif",{type:"image/gif"})).then(o=>{e.items.add(o),t.files=e.files,n.click()}):console.log("Url of the session GIF:",o),u(!0)}):(console.log("Goldeneye Object Detector notification: There were no frames detected during this session to create a gif."),u(!0))}function p(e){return new Promise((t,n)=>{gifshot.createGIF({images:e,gifWidth:300,gifHeight:165,interval:.1,numFrames:e.length,frameDuration:1,sampleInterval:10,numWorkers:2},e=>{e.error?n(e.error):t(e.image)})})}function m(l,r){r.detect(l).then(a=>{if(u(!0),i.push(c.toDataURL()),void 0!==a)if(a.length>0&&a.find(e=>"cell phone"==e.class||"laptop"==e.class))!function(e){for(const t of e)["cell phone","laptop"].includes(t.class)&&p(i.slice(-30)).then(e=>{o.push(Object.assign({},t,{motionScore:null,gif:e}))})}(a);else if(t>200)if(a.length>0)for(const e of a)p(i.slice(-30)).then(n=>{o.push(Object.assign({},{bbox:e.bbox,class:e.class,score:e.score},{motionScore:t,gif:n}))});else p(i.slice(-30)).then(e=>{o.push(Object.assign({},{bbox:[],class:null,score:null},{motionScore:t,gif:e}))});s||requestAnimationFrame(()=>{m(l,r)}),function(){let o=0;d.drawImage(n,0,0,300,165);let i=d.getImageData(0,0,300,165).data;for(let t=0;t<300;t++)for(let n=0;n<165;n++){let s=4*(t+300*n);Math.abs(i[s]-(e[s]||0))+Math.abs(i[s+1]-(e[s+1]||0))+Math.abs(i[s+2]-(e[s+2]||0))>=100&&o++}e=JSON.parse(JSON.stringify(i)),t=o}()}).catch(e=>{console.log(e)})}return{objectDetectionPayload:o,start:function(e){s=!1,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{window.stream=e,n.srcObject=e}).then(()=>{u(!1,"Please wait while frames are loading..."),cocoSsd.load().then(e=>{s||m(n,e)}).catch(e=>console.log(e))}).catch(e=>console.log(e))},stop:function(e){const t=n.srcObject;if(u(!0),t){for(var o=t.getTracks(),i=0;i<o.length;i++){o[i].stop()}n.srcObject=null}s=!0,f()}}}();window.WebcamFeed=o}]);
